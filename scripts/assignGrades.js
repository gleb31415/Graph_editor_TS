// Script to assign appropriate grades (7-11) to all nodes in graphContent.js
const fs = require("fs");
const path = require("path");

// Grade assignment mapping based on Russian school curriculum
const gradeMapping = {
  // Grade 7 topics (basic mechanics, simple math)
  7: [
    "Плотность",
    "Работа с графиками",
    "Тень. Полутень.",
    "Простые механизмы",
    "Давление твердых тел",
    "Масса тела",
    "Сила тяжести",
    "Вес тела",
    "Рычаг",
    "Блок",
    "Наклонная плоскость",
    "Золотое правило механики",
    "КПД механизмов",
    "Деформация",
    "Сила упругости",
    "Закон Гука",
    "Сила трения",
    "Давление жидкостей и газов",
    "Закон Паскаля",
    "Гидравлические машины",
    "Атмосферное давление",
    "Сообщающиеся сосуды",
    "Архимедова сила",
    "Условия плавания тел",
    "Работа",
    "Мощность",
    "Энергия",
    "Кинетическая энергия",
    "Потенциальная энергия",
    "Закон сохранения энергии",
    "Температура",
    "Внутренняя энергия",
    "Способы изменения внутренней энергии",
    "Теплопроводность",
    "Конвекция",
    "Излучение",
    "Количество теплоты",
    "Удельная теплоемкость",
    "Расчет количества теплоты",
    "Энергия топлива",
    "Удельная теплота сгорания",
    "Закон сохранения и превращения энергии в механических и тепловых процессах",
    "Агрегатные состояния вещества",
    "Плавление и отвердевание",
    "График плавления и отвердевания",
    "Удельная теплота плавления",
    "Испарение. Насыщенный и ненасыщенный пар",
    "Поглощение энергии при испарении жидкости и выделение ее при конденсации пара",
    "Кипение",
    "Влажность воздуха. Способы определения влажности воздуха",
    "Удельная теплота парообразования и конденсации",
    "Работа газа и пара при расширении",
    "Двигатель внутреннего сгорания",
    "Паровая турбина",
    "КПД теплового двигателя",
  ],

  // Grade 8 topics (electricity basics, thermal physics)
  8: [
    "Электрический заряд. Закон Кулона.",
    "Электрическое поле",
    "Напряженность электрического поля",
    "Работа электрического поля",
    "Потенциал электрического поля",
    "Разность потенциалов",
    "Электроемкость. Конденсаторы",
    "Энергия электрического поля конденсатора",
    "Электрический ток",
    "Условия возникновения электрического тока",
    "Сила тока",
    "Электрическое напряжение",
    "Электрическое сопротивление",
    "Закон Ома для участка цепи",
    "Расчет сопротивления проводника. Удельное сопротивление",
    "Примеры на расчет сопротивления проводника, силы тока и напряжения",
    "Реостаты",
    "Последовательное соединение проводников",
    "Параллельное соединение проводников",
    "Работа электрического тока",
    "Мощность электрического тока",
    "Единицы работы электрического тока, применяемые на практике",
    "Нагревание проводников электрическим током. Закон Джоуля-Ленца",
    "Конденсатор",
    "Лампа накаливания. Электрические нагревательные приборы",
    "Короткое замыкание, предохранители",
    "Магнитное поле",
    "Магнитное поле прямого тока. Магнитные линии",
    "Магнитное поле катушки с током. Электромагниты",
    "Применение электромагнитов",
    "Постоянные магниты. Магнитное поле постоянных магнитов",
    "Магнитное поле Земли",
    "Действие магнитного поля на проводник с током. Электрический двигатель",
    "Индукция магнитного поля",
    "Магнитный поток",
    "Явление электромагнитной индукции",
    "Направление индукционного тока. Правило Ленца",
    "Явление самоиндукции",
    "Получение и передача переменного электрического тока. Трансформатор",
    "Электромагнитное поле",
    "Электромагнитные волны",
    "Колебательный контур",
    "Получение электромагнитных колебаний",
    "Принципы радиосвязи и телевидения",
    "Электромагнитная природа света",
    "Преломление света",
    "Физический смысл показателя преломления",
    "Дисперсия света. Цвета тел",
    "Спектрограф и спектроскоп",
    "Типы оптических спектров",
    "Спектральный анализ",
    "Поглощение и испускание света атомами. Происхождение линейчатых спектров",
  ],

  // Grade 9 topics (kinematics, dynamics, momentum)
  9: [
    "Равномерное прямолинейное движение",
    "Материальная точка. Система отсчета",
    "Перемещение",
    "Определение координаты движущегося тела",
    "Перемещение при прямолинейном равномерном движении",
    "Прямолинейное равноускоренное движение. Ускорение",
    "Скорость прямолинейного равноускоренного движения. График скорости",
    "Перемещение при прямолинейном равноускоренном движении",
    "Перемещение тела при прямолинейном равноускоренном движении без начальной скорости",
    "Относительность движения",
    "Инерциальные системы отсчета. Первый закон Ньютона",
    "Второй закон Ньютона",
    "Третий закон Ньютона",
    "Свободное падение тел",
    "Движение тела, брошенного вертикально вверх. Невесомость",
    "Закон всемирного тяготения",
    "Ускорение свободного падения на Земле и других небесных телах",
    "Прямолинейное и криволинейное движение",
    "Движение тела по окружности с постоянной по модулю скоростью",
    "Искусственные спутники Земли",
    "Импульс тела. Закон сохранения импульса",
    "Реактивное движение. Ракеты",
    "Вынужденные колебания. Резонанс",
    "Механические колебания",
    "Свободные колебания",
    "Величины, характеризующие колебательное движение",
    "Гармонические колебания",
    "Затухающие колебания",
    "Распространение колебаний в среде. Волны",
    "Длина волны. Скорость распространения волн",
    "Источники звука. Звуковые колебания",
    "Высота, тембр и громкость звука",
    "Распространение звука. Звуковые волны",
    "Отражение звука. Звуковой резонанс",
  ],

  // Grade 10 topics (advanced mechanics, thermodynamics)
  10: [
    "Температура. Связь температуры с кинетической энергией движения молекул.",
    "Основное уравнение молекулярно-кинетической теории",
    "Температура и тепловое равновесие",
    "Определение температуры",
    "Абсолютная температура. Температура — мера средней кинетической энергии молекул",
    "Измерение скоростей молекул газа",
    "Уравнение состояния идеального газа",
    "Газовые законы",
    "Насыщенный пар",
    "Зависимость давления насыщенного пара от температуры. Кипение",
    "Влажность воздуха",
    "Кристаллические и аморфные тела",
    "Внутренняя энергия",
    "Работа в термодинамике",
    "Количество теплоты",
    "Первый закон термодинамики",
    "Применение первого закона термодинамики к различным процессам",
    "Необратимость процессов в природе",
    "Статистическое истолкование необратимости процессов в природе",
    "Принципы действия тепловых двигателей",
    "Коэффициент полезного действия (КПД) тепловых двигателей",
    "Электростатическое поле",
    "Закон сохранения электрического заряда",
    "Потенциальность электростатического поля",
    "Потенциал и разность потенциалов",
    "Связь между напряженностью электростатического поля и разностью потенциалов",
    "Диэлектрики в электростатическом поле",
    "Проводники в электростатическом поле",
    "Электрическая емкость. Конденсатор",
    "Энергия заряженного конденсатора",
    "Электрический ток. Сила тока",
    "Закон Ома для участка цепи. Сопротивление",
    "Электрические цепи. Последовательное и параллельное соединения проводников",
    "Работа и мощность постоянного тока",
    "Электродвижущая сила",
    "Закон Ома для полной цепи",
    "Электрический ток в металлах",
    "Зависимость сопротивления от температуры",
    "Сверхпроводимость",
    "Электрический ток в полупроводниках",
    "Электрическая проводимость различных веществ",
    "Электрический ток в вакууме",
    "Электронные пучки. Электронно-лучевая трубка",
    "Электрический ток в жидкостях",
    "Электрический ток в газах",
    "Несамостоятельный и самостоятельный разряды",
    "Плазма",
  ],

  // Grade 11 topics (oscillations, waves, optics, quantum physics)
  11: [
    "Взаимодействие токов",
    "Вектор магнитной индукции",
    "Сила Ампера",
    "Сила Лоренца",
    "Магнитные свойства вещества",
    "Открытие электромагнитной индукции",
    "Магнитный поток",
    "Закон электромагнитной индукции",
    "Вихревое электрическое поле",
    "ЭДС индукции в движущихся проводниках",
    "Самоиндукция",
    "Индуктивность",
    "Энергия магнитного поля тока",
    "Электромагнитное поле",
    "Свободные электромагнитные колебания",
    "Превращение энергии при электромагнитных колебаниях",
    "Аналогия между механическими и электромагнитными колебаниями",
    "Уравнение, описывающее процессы в колебательном контуре",
    "Переменный электрический ток",
    "Активное сопротивление",
    "Действующие значения силы тока и напряжения",
    "Конденсатор в цепи переменного тока",
    "Катушка индуктивности в цепи переменного тока",
    "Резонанс в электрической цепи",
    "Генерирование электрической энергии",
    "Трансформаторы",
    "Производство и использование электрической энергии",
    "Передача электроэнергии",
    "Электромагнитная волна",
    "Экспериментальное обнаружение электромагнитных волн",
    "Плотность потока электромагнитного излучения",
    "Изобретение радио А. С. Поповым",
    "Принципы радиосвязи",
    "Модуляция и детектирование",
    "Свойства электромагнитных волн",
    "Распространение радиоволн",
    "Радиолокация",
    "Понятие о телевидении",
    "Развитие средств связи",
    "Скорость света",
    "Принцип Гюйгенса",
    "Закон отражения света",
    "Закон преломления света",
    "Полное внутреннее отражение",
    "Линза",
    "Построение изображения в линзе",
    "Формула тонкой линзы",
    "Увеличение линзы",
    "Дисперсия света",
    "Интерференция механических волн",
    "Интерференция света",
    "Некоторые применения интерференции",
    "Дифракция механических волн",
    "Дифракция света",
    "Дифракционная решетка",
    "Поперечность световых волн. Поляризация света",
    "Излучение и спектры",
    "Шкала электромагнитных волн",
    "Фотоэффект",
    "Теория фотоэффекта",
    "Фотоны",
    "Применение фотоэффекта",
    "Давление света",
    "Химическое действие света. Фотография",
    "Строение атома",
    "Опыты Резерфорда",
    "Квантовые постулаты Бора",
    "Модель атома водорода по Бору",
    "Трудности теории Бора. Квантовая механика",
    "Лазеры",
    "Методы наблюдения и регистрации элементарных частиц",
    "Открытие радиоактивности",
    "Альфа-, бета- и гамма-излучения",
    "Радиоактивные превращения",
    "Закон радиоактивного распада",
    "Период полураспада",
    "Изотопы",
    "Открытие нейтрона",
    "Строение атомного ядра",
    "Ядерные силы",
    "Энергия связи атомных ядер",
    "Ядерные реакции",
    "Деление ядер урана",
    "Цепные ядерные реакции",
    "Ядерный реактор",
    "Термоядерные реакции",
    "Применение ядерной энергии",
    "Получение радиоактивных изотопов и их применение",
    "Биологическое действие радиоактивных излучений",
    "Элементарные частицы",
    "Античастицы",
  ],
};

// Special nodes that should be excluded from grade assignment
const specialNodes = ["TheSolution"];

const filePath = path.join(__dirname, "..", "src", "_lib", "graphContent.js");

// Read the file
let content = fs.readFileSync(filePath, "utf8");

// Build a lookup map of topic name to grade
const topicToGrade = {};
for (const [grade, topics] of Object.entries(gradeMapping)) {
  for (const topic of topics) {
    topicToGrade[topic] = grade;
  }
}

// Function to determine grade based on node id and section
function determineGrade(nodeId, section) {
  // Special handling for TheSolution node
  if (specialNodes.includes(nodeId)) {
    return "11";
  }

  // Direct lookup
  if (topicToGrade[nodeId]) {
    return topicToGrade[nodeId];
  }

  // Fallback based on section and complexity patterns
  const nodeIdLower = nodeId.toLowerCase();

  // Basic math concepts
  if (
    section === "математика" &&
    (nodeIdLower.includes("график") ||
      nodeIdLower.includes("координат") ||
      nodeIdLower.includes("функци") ||
      nodeIdLower.includes("уравнени"))
  ) {
    return "7";
  }

  // Basic mechanics
  if (
    section === "механика" &&
    (nodeIdLower.includes("масса") ||
      nodeIdLower.includes("плотность") ||
      nodeIdLower.includes("сила") ||
      nodeIdLower.includes("давление") ||
      nodeIdLower.includes("простые"))
  ) {
    return "7";
  }

  // Electricity basics
  if (
    section === "электромагнетизм" &&
    (nodeIdLower.includes("заряд") ||
      nodeIdLower.includes("ток") ||
      nodeIdLower.includes("напряжение") ||
      nodeIdLower.includes("сопротивление") ||
      nodeIdLower.includes("цепи"))
  ) {
    return "8";
  }

  // Advanced mechanics
  if (
    section === "механика" &&
    (nodeIdLower.includes("равноускоренн") ||
      nodeIdLower.includes("ускорени") ||
      nodeIdLower.includes("импульс") ||
      nodeIdLower.includes("колебани") ||
      nodeIdLower.includes("волн"))
  ) {
    return "9";
  }

  // Thermodynamics
  if (section === "термодинамика") {
    if (
      nodeIdLower.includes("температура") ||
      nodeIdLower.includes("молекул") ||
      nodeIdLower.includes("газ") ||
      nodeIdLower.includes("пар")
    ) {
      return "10";
    }
    return "8";
  }

  // Optics
  if (section === "оптика") {
    if (
      nodeIdLower.includes("интерференц") ||
      nodeIdLower.includes("дифракц") ||
      nodeIdLower.includes("поляризац") ||
      nodeIdLower.includes("фотоэффект") ||
      nodeIdLower.includes("квантов")
    ) {
      return "11";
    }
    return "8";
  }

  // Nuclear physics and quantum mechanics
  if (
    section === "атомная физика" ||
    nodeIdLower.includes("атом") ||
    nodeIdLower.includes("ядр") ||
    nodeIdLower.includes("квантов") ||
    nodeIdLower.includes("фотон") ||
    nodeIdLower.includes("радиоактивн")
  ) {
    return "11";
  }

  // Default grade based on section
  switch (section) {
    case "математика":
      return "7";
    case "механика":
      return "9";
    case "электромагнетизм":
      return "8";
    case "термодинамика":
      return "10";
    case "оптика":
      return "11";
    default:
      return "9";
  }
}

// Replace all grade: "beyond" occurrences
const lines = content.split("\n");
let currentNodeId = "";
let currentSection = "";

for (let i = 0; i < lines.length; i++) {
  const line = lines[i];

  // Extract node id
  const idMatch = line.match(/id:\s*"([^"]+)"/);
  if (idMatch) {
    currentNodeId = idMatch[1];
  }

  // Extract section
  const sectionMatch = line.match(/section:\s*"([^"]*)"/);
  if (sectionMatch) {
    currentSection = sectionMatch[1];
  }

  // Replace grade
  if (line.includes('grade: "beyond"')) {
    const grade = determineGrade(currentNodeId, currentSection);
    lines[i] = line.replace('grade: "beyond"', `grade: "${grade}"`);
    console.log(
      `Assigned grade ${grade} to "${currentNodeId}" (section: ${currentSection})`
    );
  }
}

// Write the updated content back to the file
const updatedContent = lines.join("\n");
fs.writeFileSync(filePath, updatedContent, "utf8");

console.log("\nGrade assignment completed successfully!");
